# nlp16emu

## Introduction

本ソフトウェアは，NANDゲートのみで作られた16bit CPUであるNLP-16 (NAND Logic Processor-16bit processor) [1] のエミュレータです．NLP-16は，ちぇりーたくあん🍒さんによって開発されています．

## Usage

エミュレータはWebブラウザ上で動作します．Webブラウザで，HTTPを経由してindex.jsを開いてください．実行手順は以下のとおりです．

1. プログラムをロードする
画面左上にプログラムをロードするためのformがあると思います．バイナリ形式は純粋なバイナリファイル用で，テキスト形式はテキスト化されたバイナリ用です．プログラムは，ucan-nos様によるアセンブラ[2]で開発してください．アセンブラの出力をそのままテキスト形式として読み込むことが可能です．
プログラムを読み込むと，画面左側にプログラムが表示されます．

2. 動作準備
画面情報にある「Reset」をクリックしてください．

3. 実行
画面上部の「Step実行」もしくは「通常実行」をクリックするとプログラムを実行できます．
Step実行は，文字通り1命令ずつ実行していきます．
通常実行は，連続して実行していきます．実行する前にプログラムのアドレスをクリックするとブレークポイントを設置でき，ブレークポイントまで実行して一時停止します．なお，ブレークポイントは何箇所でも設置できますが，命令の1word目のアドレスに設置しないと一時停止しないので注意してください．
Step実行してから通常実行したり，通常実行して一時停止したあとでStep実行することが可能です．
※ブレークポイントの設置は，プログラムをロードしてResetをクリックした後でないと行えません．

## Layout

画面レイアウトの大雑把な説明です．

### 画面上部

左から，プログラムロードのためのform，Reset，Step実行，通常実行ボタン

### 画面中部

左から，プログラム，レジスタ，フラグとインジケータ
実行すると，プログラム中の実行している命令や，変更されたレジスタやフラグなどに色が付きます．
※NLP-16のプログラムがエラーで停止すると，Terminateインジケータが点灯します．

### 画面下部

NLP-16と接続したコンソールの画面（プログラムから文字を出力することが可能です）
※エスケープシーケンスは現状では対応していません

### フォント

けしかん様によるDSEGフォント[3]を利用しています．

## Architecture

エミュレータ本体はnlp16.js内のnlp16クラスで構成しています．Webのインタフェースは，index.htmlとindex.jsで提供しています．
nlp16クラスはCLIから使用することも想定しています．具体的な使用方法はtests内のファイルを参照してください．
※nlp16クラスの使用方法は，今後変更する可能性があります．現状の使用方法は，ありあわせで実装したものなので，使いにくいためです．

## Files

主なファイルを以下に示します．

File/Directory | 内容
-|-
index.html | エミュレータの外装
main.js | CLIから実行するサンプル（現在動作しません）
css/web_nlp16.css | index.htmlの装飾
examples/ | NLP-16のサンプルプログラム
modules/index.js | Web版エミュレータのUI
modules/nlp16.js | エミュレータ本体
tests/*.asm | テストプログラム
tests/*.bin | テキスト化された実行可能バイナリ
tests/*.js | テストプログラムを実行するプログラム

テストプログラム（tests/*.js）はdenoで実行する（deno test）ことを想定して書いています．
エミュレータ本体（nlp16.js）は，Webブラウザ/node.js/denoのいずれでも利用できるように書いています．

## Bugs

一通りの動作確認を行ったはずですが，エミュレート内容とWebインタフェースの双方に想定していない不具合が有ると思われます．issueにご報告いただけると助かります．

## Reference

1. [NAND(74HC00)だけで16bitCPUを作る[NLP-16]](https://cherry-takuan.org/article/?id=3)
2. [cherry-nlp16-assembler](https://github.com/uchan-nos/cherry-nlp16-assembler)
3. [7セグ・14セグフォント 「DSEG」](https://www.keshikan.net/fonts.html)
